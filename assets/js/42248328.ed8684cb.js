"use strict";(self.webpackChunkvolca_docs=self.webpackChunkvolca_docs||[]).push([[865],{3905:(e,t,n)=>{n.d(t,{Zo:()=>s,kt:()=>y});var a=n(7294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},o=Object.keys(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var u=a.createContext({}),p=function(e){var t=a.useContext(u),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},s=function(e){var t=p(e.components);return a.createElement(u.Provider,{value:t},e.children)},d="mdxType",m={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},c=a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,o=e.originalType,u=e.parentName,s=l(e,["components","mdxType","originalType","parentName"]),d=p(n),c=r,y=d["".concat(u,".").concat(c)]||d[c]||m[c]||o;return n?a.createElement(y,i(i({ref:t},s),{},{components:n})):a.createElement(y,i({ref:t},s))}));function y(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var o=n.length,i=new Array(o);i[0]=c;var l={};for(var u in t)hasOwnProperty.call(t,u)&&(l[u]=t[u]);l.originalType=e,l[d]="string"==typeof e?e:r,i[1]=l;for(var p=2;p<o;p++)i[p]=n[p];return a.createElement.apply(null,i)}return a.createElement.apply(null,n)}c.displayName="MDXCreateElement"},6644:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>u,contentTitle:()=>i,default:()=>d,frontMatter:()=>o,metadata:()=>l,toc:()=>p});var a=n(7462),r=(n(7294),n(3905));const o={slug:"/deploy-to-aws"},i="4. Deploy to AWS",l={unversionedId:"project-setup/deploy-to-aws",id:"project-setup/deploy-to-aws",title:"4. Deploy to AWS",description:"Learn how to deploy your project to AWS.",source:"@site/docs/project-setup/04-deploy-to-aws.md",sourceDirName:"project-setup",slug:"/deploy-to-aws",permalink:"/deploy-to-aws",draft:!1,tags:[],version:"current",sidebarPosition:4,frontMatter:{slug:"/deploy-to-aws"},sidebar:"tutorialSidebar",previous:{title:"3. Configure AWS",permalink:"/configure-aws"},next:{title:"5. Configure authentication",permalink:"/configure-authentication"}},u={},p=[{value:"Prerequisites",id:"prerequisites",level:2},{value:"Configure",id:"configure",level:2},{value:"Setup infrastructure",id:"setup-infrastructure",level:2},{value:"Validating e-mail identity",id:"validating-e-mail-identity",level:2},{value:"DNS records for authentication",id:"dns-records-for-authentication",level:2},{value:"Push your code",id:"push-your-code",level:2},{value:"Done!",id:"done",level:2}],s={toc:p};function d(e){let{components:t,...n}=e;return(0,r.kt)("wrapper",(0,a.Z)({},s,n,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"4-deploy-to-aws"},"4. Deploy to AWS"),(0,r.kt)("p",null,"Learn how to deploy your project to AWS."),(0,r.kt)("h2",{id:"prerequisites"},"Prerequisites"),(0,r.kt)("p",null,"To complete this guide, you need:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"An ",(0,r.kt)("a",{parentName:"li",href:"/configure-aws"},"AWS account")," with configured credentials in your CLI"),(0,r.kt)("li",{parentName:"ul"},"A domain name where you have access to control DNS settings"),(0,r.kt)("li",{parentName:"ul"},"An e-mail address belonging to your domain name which will be used as the sender for any e-mails sent by your project")),(0,r.kt)("h2",{id:"configure"},"Configure"),(0,r.kt)("p",null,"The file ",(0,r.kt)("inlineCode",{parentName:"p"},"app.config.ts")," in the root directory holds the configuration for your AWS environment. Configure your account details under the ",(0,r.kt)("inlineCode",{parentName:"p"},"aws")," section in ",(0,r.kt)("inlineCode",{parentName:"p"},"coreConfig")," in this file before you proceed."),(0,r.kt)("h2",{id:"setup-infrastructure"},"Setup infrastructure"),(0,r.kt)("p",null,"To enable GitHub Actions to deploy any new changes pushed to your repository, a number of resources need to exist in your account. These resources are:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"An OpenID Connect (OIDC) identity provider that allows GitHub to identity itself"),(0,r.kt)("li",{parentName:"ul"},"IAM roles that allow GitHub Actions to deploy resources in your AWS account"),(0,r.kt)("li",{parentName:"ul"},"A Route53 hosted zone to manage your domain"),(0,r.kt)("li",{parentName:"ul"},"A verified Amazon SES e-mail")),(0,r.kt)("p",null,"To create these resources in your account, run the following command:"),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"yarn setup:aws")),(0,r.kt)("admonition",{type:"note"},(0,r.kt)("p",{parentName:"admonition"},"If you configured an AWS profile for your account, remember to add it when running the command: ",(0,r.kt)("inlineCode",{parentName:"p"},"AWS_PROFILE=<your-profile> yarn setup:aws"))),(0,r.kt)("p",null,"Once the script has finished, it will output a list name servers that you need to point your domain to, for example:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"Name servers\nns-1126.awsdns-12.org\nns-642.awsdns-16.net\nns-220.awsdns-27.com\nns-1943.awsdns-50.co.uk\n")),(0,r.kt)("p",null,"Take the list of name servers and add them to your domain registration as NS records. For example:"),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"Hostname"),(0,r.kt)("th",{parentName:"tr",align:null},"Type"),(0,r.kt)("th",{parentName:"tr",align:null},"Data"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"staging.my-app.com"),(0,r.kt)("td",{parentName:"tr",align:null},"NS"),(0,r.kt)("td",{parentName:"tr",align:null},"ns-1126.awsdns-12.org")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null}),(0,r.kt)("td",{parentName:"tr",align:null}),(0,r.kt)("td",{parentName:"tr",align:null},"ns-642.awsdns-16.net")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null}),(0,r.kt)("td",{parentName:"tr",align:null}),(0,r.kt)("td",{parentName:"tr",align:null},"ns-220.awsdns-27.com")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null}),(0,r.kt)("td",{parentName:"tr",align:null}),(0,r.kt)("td",{parentName:"tr",align:null},"ns-1943.awsdns-50.co.uk")))),(0,r.kt)("admonition",{type:"caution"},(0,r.kt)("p",{parentName:"admonition"},"Some DNS providers will display the list of hostnames differently. You might have to enter ",(0,r.kt)("inlineCode",{parentName:"p"},"staging.my-app.com")," or just ",(0,r.kt)("inlineCode",{parentName:"p"},"staging")," as the hostname. Have a look at the existing entries to understand how it should be entered. For example, if there is only a ",(0,r.kt)("inlineCode",{parentName:"p"},"www")," entry instead of ",(0,r.kt)("inlineCode",{parentName:"p"},"www.my-app.com"),", then you should only enter ",(0,r.kt)("inlineCode",{parentName:"p"},"staging"),".")),(0,r.kt)("p",null,"You will also receive an e-mail from AWS that prompts you to verify your e-mail address. Click the link to get your address verified and ready to send e-mails."),(0,r.kt)("h2",{id:"validating-e-mail-identity"},"Validating e-mail identity"),(0,r.kt)("p",null,"Volca will setup a verified domain in AWS SES to allow you to send emails from your service. The domain is validated through DKIM (Domain Keys Identified Mail). For this to function, you will need to point a subdomain of your application to the name servers described in the previous section. This will automatically verify your domain."),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"Hostname"),(0,r.kt)("th",{parentName:"tr",align:null},"Type"),(0,r.kt)("th",{parentName:"tr",align:null},"Data"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"mail.my-app.com"),(0,r.kt)("td",{parentName:"tr",align:null},"NS"),(0,r.kt)("td",{parentName:"tr",align:null},"ns-1126.awsdns-12.org")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null}),(0,r.kt)("td",{parentName:"tr",align:null}),(0,r.kt)("td",{parentName:"tr",align:null},"ns-642.awsdns-16.net")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null}),(0,r.kt)("td",{parentName:"tr",align:null}),(0,r.kt)("td",{parentName:"tr",align:null},"ns-220.awsdns-27.com")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null}),(0,r.kt)("td",{parentName:"tr",align:null}),(0,r.kt)("td",{parentName:"tr",align:null},"ns-1943.awsdns-50.co.uk")))),(0,r.kt)("h2",{id:"dns-records-for-authentication"},"DNS records for authentication"),(0,r.kt)("p",null,"Volca will also set up a subdomain for user authentication that will be hosed on the ",(0,r.kt)("inlineCode",{parentName:"p"},"login")," subdomain of your app. So make sure to route the subdomain ",(0,r.kt)("inlineCode",{parentName:"p"},"login.<my-app>.com")," to the name servers previously specified."),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"Hostname"),(0,r.kt)("th",{parentName:"tr",align:null},"Type"),(0,r.kt)("th",{parentName:"tr",align:null},"Data"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"login.my-app.com"),(0,r.kt)("td",{parentName:"tr",align:null},"NS"),(0,r.kt)("td",{parentName:"tr",align:null},"ns-1126.awsdns-12.org")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null}),(0,r.kt)("td",{parentName:"tr",align:null}),(0,r.kt)("td",{parentName:"tr",align:null},"ns-642.awsdns-16.net")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null}),(0,r.kt)("td",{parentName:"tr",align:null}),(0,r.kt)("td",{parentName:"tr",align:null},"ns-220.awsdns-27.com")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null}),(0,r.kt)("td",{parentName:"tr",align:null}),(0,r.kt)("td",{parentName:"tr",align:null},"ns-1943.awsdns-50.co.uk")))),(0,r.kt)("h2",{id:"push-your-code"},"Push your code"),(0,r.kt)("admonition",{type:"note"},(0,r.kt)("p",{parentName:"admonition"},"Wait until the name servers have propagated to proceed with this step. We recommend waiting for ~30 minutes. If your name servers have not yet propagated, the GitHub Action mentioned below will time out. If this happens, wait a few more minutes and retry the Action in the GitHub interface.")),(0,r.kt)("p",null,"Next, GitHub Actions will take over the deployment. To trigger GitHub Actions, commit your changes and push them to the ",(0,r.kt)("inlineCode",{parentName:"p"},"main")," branch. Then head over to your repository in GitHub to see the progress. If any action would fail, check the logs in the Actions tab in your repository and refer to the documentation if something goes wrong."),(0,r.kt)("p",null,"Once it has finished, your environment is deployed and new changes that you push to main will be automatically deployed."),(0,r.kt)("h2",{id:"done"},"Done!"),(0,r.kt)("p",null,"Your project should now be available at ",(0,r.kt)("inlineCode",{parentName:"p"},"https://app.your-domain.com"),"."))}d.isMDXComponent=!0}}]);