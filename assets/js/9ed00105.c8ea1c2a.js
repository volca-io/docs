"use strict";(self.webpackChunkvolca_docs=self.webpackChunkvolca_docs||[]).push([[4],{3905:(e,n,t)=>{t.d(n,{Zo:()=>c,kt:()=>E});var r=t(7294);function o(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function a(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,r)}return t}function i(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?a(Object(t),!0).forEach((function(n){o(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):a(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function s(e,n){if(null==e)return{};var t,r,o=function(e,n){if(null==e)return{};var t,r,o={},a=Object.keys(e);for(r=0;r<a.length;r++)t=a[r],n.indexOf(t)>=0||(o[t]=e[t]);return o}(e,n);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)t=a[r],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(o[t]=e[t])}return o}var l=r.createContext({}),p=function(e){var n=r.useContext(l),t=n;return e&&(t="function"==typeof e?e(n):i(i({},n),e)),t},c=function(e){var n=p(e.components);return r.createElement(l.Provider,{value:n},e.children)},u="mdxType",m={inlineCode:"code",wrapper:function(e){var n=e.children;return r.createElement(r.Fragment,{},n)}},g=r.forwardRef((function(e,n){var t=e.components,o=e.mdxType,a=e.originalType,l=e.parentName,c=s(e,["components","mdxType","originalType","parentName"]),u=p(t),g=o,E=u["".concat(l,".").concat(g)]||u[g]||m[g]||a;return t?r.createElement(E,i(i({ref:n},c),{},{components:t})):r.createElement(E,i({ref:n},c))}));function E(e,n){var t=arguments,o=n&&n.mdxType;if("string"==typeof e||o){var a=t.length,i=new Array(a);i[0]=g;var s={};for(var l in n)hasOwnProperty.call(n,l)&&(s[l]=n[l]);s.originalType=e,s[u]="string"==typeof e?e:o,i[1]=s;for(var p=2;p<a;p++)i[p]=t[p];return r.createElement.apply(null,i)}return r.createElement.apply(null,t)}g.displayName="MDXCreateElement"},9733:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>l,contentTitle:()=>i,default:()=>u,frontMatter:()=>a,metadata:()=>s,toc:()=>p});var r=t(7462),o=(t(7294),t(3905));const a={sidebar_position:6,slug:"/configuration"},i="Configuration",s={unversionedId:"configuration",id:"configuration",title:"Configuration",description:"All configuration parameters for a Volca app reside in the app.config.ts file at the root of the repository. Here is an example of how such a file could look like:",source:"@site/docs/configuration.md",sourceDirName:".",slug:"/configuration",permalink:"/docs/configuration",draft:!1,tags:[],version:"current",sidebarPosition:6,frontMatter:{sidebar_position:6,slug:"/configuration"},sidebar:"tutorialSidebar",previous:{title:"Without custom domain",permalink:"/docs/deploying/without-custom-domain"},next:{title:"Migrations",permalink:"/docs/migrations"}},l={},p=[{value:"Environment variables",id:"environment-variables",level:2},{value:"Secrets",id:"secrets",level:3},{value:"Local environment variables",id:"local-environment-variables",level:3}],c={toc:p};function u(e){let{components:n,...t}=e;return(0,o.kt)("wrapper",(0,r.Z)({},c,t,{components:n,mdxType:"MDXLayout"}),(0,o.kt)("h1",{id:"configuration"},"Configuration"),(0,o.kt)("p",null,"All configuration parameters for a Volca app reside in the ",(0,o.kt)("inlineCode",{parentName:"p"},"app.config.ts")," file at the root of the repository. Here is an example of how such a file could look like:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-ts",metastring:'title="app.config.ts"',title:'"app.config.ts"'},"import { Config } from './config/types';\nimport { DEFAULT_ENVIRONMENT_VARIABLES, getEnvVar } from './config/utils';\n\nexport const config: Config = {\n  name: 'my-app',\n  github: {\n    organization: 'my-github-organization',\n    repository: 'my-github-repository',\n  },\n  environments: {\n    local: {\n      environmentVariables: {\n        ...DEFAULT_ENVIRONMENT_VARIABLES,\n        APP_DOMAIN: getEnvVar('APP_DOMAIN', '127.0.0.1:3000'),\n        DB_PASSWORD: getEnvVar('PASSWORD', 'postgres'),\n        DB_USERNAME: getEnvVar('USERNAME', 'postgres'),\n        ENVIRONMENT: 'local',\n        FROM_EMAIL: getEnvVar('FROM_EMAIL', 'noreply@example.com'),\n        LOG_LEVEL: getEnvVar('LOG_LEVEL', 'debug'),\n        SIGNING_KEY: getEnvVar('SIGNING_KEY', 'signing-key'),\n        STRIPE_KEY: getEnvVar('STRIPE_KEY', 'stripe-key'),\n        STRIPE_PRICE_ID: getEnvVar('STRIPE_PRICE_ID', 'stripe-price-id'),\n        STRIPE_WEBHOOK_SECRET: getEnvVar('STRIPE_WEBHOOK_SECRET', 'stripe-webhook-secret'),\n      },\n    },\n    staging: {\n      deploymentConfig: {\n        domain: 'staging.example.com',\n        aws: {\n          account: '000000000000',\n          region: 'us-east-1',\n          publicDatabase: true,\n        },\n      },\n      environmentVariables: {\n        ...DEFAULT_ENVIRONMENT_VARIABLES,\n        APP_DOMAIN: '${ssm:/staging/APP_DOMAIN}',\n        DB_PASSWORD: '${ssm:/staging/DB_PASSWORD}',\n        DB_USERNAME: 'app',\n        ENVIRONMENT: 'staging',\n        FROM_EMAIL: 'noreply@example.com',\n        LOG_LEVEL: 'info',\n        SIGNING_KEY: '${ssm:/staging/SIGNING_KEY}',\n        STRIPE_KEY: '${ssm:/staging/STRIPE_KEY}',\n        STRIPE_PRICE_ID: 'price_xxx',\n        STRIPE_WEBHOOK_SECRET: '${ssm:/staging/STRIPE_WEBHOOK_SECRET}',\n      },\n    },\n    production: {\n      deploymentConfig: {\n        domain: 'production.example.com',\n        aws: {\n          account: '000000000000',\n          region: 'us-east-1',\n          publicDatabase: true,\n        },\n      },\n      environmentVariables: {\n        ...DEFAULT_ENVIRONMENT_VARIABLES,\n        APP_DOMAIN: '${ssm:/production/APP_DOMAIN}',\n        DB_PASSWORD: '${ssm:/production/DB_PASSWORD}',\n        DB_USERNAME: 'app',\n        ENVIRONMENT: 'production',\n        FROM_EMAIL: 'noreply@example.com',\n        LOG_LEVEL: 'info',\n        SIGNING_KEY: '${ssm:/production/SIGNING_KEY}',\n        STRIPE_KEY: '${ssm:/production/STRIPE_KEY}',\n        STRIPE_PRICE_ID: 'price_xxx',\n        STRIPE_WEBHOOK_SECRET: '${ssm:/production/STRIPE_WEBHOOK_SECRET}',\n      },\n    },\n  },\n};\n\n")),(0,o.kt)("p",null,"Here we define"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"The name of your project which is used to name AWS resources belonging to your project"),(0,o.kt)("li",{parentName:"ul"},"The GitHub repository that you will be using"),(0,o.kt)("li",{parentName:"ul"},"AWS account configurations for each environment"),(0,o.kt)("li",{parentName:"ul"},"Environment variables for each environment")),(0,o.kt)("h2",{id:"environment-variables"},"Environment variables"),(0,o.kt)("p",null,"To add a new environment variable, first add it to the ",(0,o.kt)("inlineCode",{parentName:"p"},"EnvironmentVariable")," type in ",(0,o.kt)("inlineCode",{parentName:"p"},"config/types.ts")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-ts",metastring:'title="config/types.ts"',title:'"config/types.ts"'},"export enum EnvironmentVariable {\n  ...\n  MY_VARIABLE = 'MY_VARIABLE',\n  ...\n}\n")),(0,o.kt)("p",null,"And then you can proceed with adding it to the ",(0,o.kt)("inlineCode",{parentName:"p"},"app.config.ts")," file. If your variable can be stored as plain text and pushed to GitHub, proceed reading below. If not, proceed to the ",(0,o.kt)("a",{parentName:"p",href:"#secrets"},"secrets")," section."),(0,o.kt)("p",null,"The environment variable can be added to ",(0,o.kt)("inlineCode",{parentName:"p"},"app.config.ts")," like this:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-ts",metastring:'title="app.config.ts"',title:'"app.config.ts"'},"export const config: Config = {\n  ...\n  environments: {\n    ...\n    production: {\n      ...\n      environmentVariables: {\n        MY_VARIABLE: '${ssm:/staging/MY_VARIABLE}',\n      },\n    },\n   ...\n  },\n};\n\n")),(0,o.kt)("p",null,"Since the environment variables are typed, you will need to provide values for all your environments to make sure you don't forget one."),(0,o.kt)("h3",{id:"secrets"},"Secrets"),(0,o.kt)("p",null,"The environment variables that you do not want to keep in your source code such as passwords, API keys and other credentials can be stored as encrypted parameters in AWS. To reference a secret in SSM, use the syntax ",(0,o.kt)("inlineCode",{parentName:"p"},"${ssm:/staging/MY_SECRET}")," in ",(0,o.kt)("inlineCode",{parentName:"p"},"app.config.ts"),"."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-ts",metastring:'title="app.config.ts"',title:'"app.config.ts"'},"export const config: Config = {\n  ...\n  environments: {\n    ...\n    production: {\n      ...\n      environmentVariables: {\n        MY_SECRET: '${ssm:/staging/MY_SECRET}',\n      },\n    },\n   ...\n  },\n};\n\n")),(0,o.kt)("p",null,"Any secrets you add here must be added to AWS parameter store by:"),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},"Going to Services -> Systems Manager -> Parameter Store -> Create parameter"),(0,o.kt)("li",{parentName:"ol"},"Enter a name following the pattern ",(0,o.kt)("inlineCode",{parentName:"li"},"/<environment>/MY_SECRET")),(0,o.kt)("li",{parentName:"ol"},"Picking ",(0,o.kt)("inlineCode",{parentName:"li"},"SecureString")," as the type"),(0,o.kt)("li",{parentName:"ol"},"Entering the value"),(0,o.kt)("li",{parentName:"ol"},"Clicking Create parameter")),(0,o.kt)("p",null,"The same method can also be used to reference any parameter stored in SSM, such as dynamic values from a CloudFormation stack."),(0,o.kt)("h3",{id:"local-environment-variables"},"Local environment variables"),(0,o.kt)("p",null,"The default ",(0,o.kt)("inlineCode",{parentName:"p"},"app.config.ts")," files picks local environment variables from a ",(0,o.kt)("inlineCode",{parentName:"p"},".env")," file if you have one. If you don't, simply create one at the root of the repository and you can override any environment variable like this:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"MY_VARIABLE=my-value\n")))}u.isMDXComponent=!0}}]);