"use strict";(self.webpackChunkvolca_docs=self.webpackChunkvolca_docs||[]).push([[672],{3905:(e,t,r)=>{r.d(t,{Zo:()=>d,kt:()=>m});var o=r(7294);function n(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function a(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,o)}return r}function i(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?a(Object(r),!0).forEach((function(t){n(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):a(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function l(e,t){if(null==e)return{};var r,o,n=function(e,t){if(null==e)return{};var r,o,n={},a=Object.keys(e);for(o=0;o<a.length;o++)r=a[o],t.indexOf(r)>=0||(n[r]=e[r]);return n}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(o=0;o<a.length;o++)r=a[o],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(n[r]=e[r])}return n}var p=o.createContext({}),c=function(e){var t=o.useContext(p),r=t;return e&&(r="function"==typeof e?e(t):i(i({},t),e)),r},d=function(e){var t=c(e.components);return o.createElement(p.Provider,{value:t},e.children)},s="mdxType",u={inlineCode:"code",wrapper:function(e){var t=e.children;return o.createElement(o.Fragment,{},t)}},h=o.forwardRef((function(e,t){var r=e.components,n=e.mdxType,a=e.originalType,p=e.parentName,d=l(e,["components","mdxType","originalType","parentName"]),s=c(r),h=n,m=s["".concat(p,".").concat(h)]||s[h]||u[h]||a;return r?o.createElement(m,i(i({ref:t},d),{},{components:r})):o.createElement(m,i({ref:t},d))}));function m(e,t){var r=arguments,n=t&&t.mdxType;if("string"==typeof e||n){var a=r.length,i=new Array(a);i[0]=h;var l={};for(var p in t)hasOwnProperty.call(t,p)&&(l[p]=t[p]);l.originalType=e,l[s]="string"==typeof e?e:n,i[1]=l;for(var c=2;c<a;c++)i[c]=r[c];return o.createElement.apply(null,i)}return o.createElement.apply(null,r)}h.displayName="MDXCreateElement"},891:(e,t,r)=>{r.r(t),r.d(t,{assets:()=>p,contentTitle:()=>i,default:()=>s,frontMatter:()=>a,metadata:()=>l,toc:()=>c});var o=r(7462),n=(r(7294),r(3905));const a={sidebar_position:4,slug:"/configure-stripe"},i="Configure Stripe",l={unversionedId:"getting-started/configure-stripe",id:"getting-started/configure-stripe",title:"Configure Stripe",description:"Follow the below steps to configure Stripe for you application and start accepting payments.",source:"@site/docs/getting-started/configure-stripe.md",sourceDirName:"getting-started",slug:"/configure-stripe",permalink:"/docs/configure-stripe",draft:!1,tags:[],version:"current",sidebarPosition:4,frontMatter:{sidebar_position:4,slug:"/configure-stripe"},sidebar:"tutorialSidebar",previous:{title:"Configure AWS",permalink:"/docs/configure-aws"},next:{title:"Deploying to AWS",permalink:"/docs/category/deploying-to-aws"}},p={},c=[{value:"Create a Stripe account",id:"create-a-stripe-account",level:2},{value:"Test mode",id:"test-mode",level:2},{value:"Create a product and a price",id:"create-a-product-and-a-price",level:2},{value:"Set the STRIPE_KEY and STRIPE_PRICE_ID locally",id:"set-the-stripe_key-and-stripe_price_id-locally",level:2},{value:"Set the STRIPE_KEY parameter in AWS",id:"set-the-stripe_key-parameter-in-aws",level:2},{value:"Webhooks",id:"webhooks",level:2}],d={toc:c};function s(e){let{components:t,...r}=e;return(0,n.kt)("wrapper",(0,o.Z)({},d,r,{components:t,mdxType:"MDXLayout"}),(0,n.kt)("h1",{id:"configure-stripe"},"Configure Stripe"),(0,n.kt)("p",null,"Follow the below steps to configure Stripe for you application and start accepting payments."),(0,n.kt)("h2",{id:"create-a-stripe-account"},"Create a Stripe account"),(0,n.kt)("p",null,"Head on over to ",(0,n.kt)("a",{parentName:"p",href:"https://stripe.com/"},"Stripe")," and create an account if you don't already have one."),(0,n.kt)("h2",{id:"test-mode"},"Test mode"),(0,n.kt)("p",null,'We recommend setting everything up in "Test mode" first by switching on the "Test mode" toggle in the Stripe dashboard. Once you are ready for production, follow the below steps while in production mode.'),(0,n.kt)("h2",{id:"create-a-product-and-a-price"},"Create a product and a price"),(0,n.kt)("p",null,"Once you have your Stripe account set up, it's time to create a product. Go to Products -> Add product and add your product details. Since Volca is a SaaS boilerplate, pick the ",(0,n.kt)("em",{parentName:"p"},"recurring")," billing method."),(0,n.kt)("p",null,'When you are done, save the product, scroll down to the "Pricing" heading and copy the ID of the price you just configured.'),(0,n.kt)("h2",{id:"set-the-stripe_key-and-stripe_price_id-locally"},"Set the STRIPE_KEY and STRIPE_PRICE_ID locally"),(0,n.kt)("p",null,"To get subscriptions running locally, open ",(0,n.kt)("inlineCode",{parentName:"p"},".env")," and add:"),(0,n.kt)("p",null,(0,n.kt)("inlineCode",{parentName:"p"},"STRIPE_KEY="),' The Stripe secret key found in the "Developers" tab in the Stripe dashboard'),(0,n.kt)("p",null,"And then add your ",(0,n.kt)("inlineCode",{parentName:"p"},"STRIPE_PRICE_ID")," to the ",(0,n.kt)("inlineCode",{parentName:"p"},"app.config.ts")," file."),(0,n.kt)("p",null,"Start the app and try subscribing!"),(0,n.kt)("h2",{id:"set-the-stripe_key-parameter-in-aws"},"Set the STRIPE_KEY parameter in AWS"),(0,n.kt)("p",null,"This step requires you to have deployed your app to AWS at least once by following the ",(0,n.kt)("a",{parentName:"p",href:"/docs/category/deploying-to-aws"},"deploy infrastructure guide"),"."),(0,n.kt)("ol",null,(0,n.kt)("li",{parentName:"ol"},"Open the AWS console"),(0,n.kt)("li",{parentName:"ol"},"Open Services -> Systems Manager -> Parameter Store"),(0,n.kt)("li",{parentName:"ol"},"Find the existing parameter called ",(0,n.kt)("inlineCode",{parentName:"li"},"/<environment>/STRIPE_KEY")),(0,n.kt)("li",{parentName:"ol"},"Update the parameter with your Stripe key and save"),(0,n.kt)("li",{parentName:"ol"},"For the updated parameter to be updated in your app, you need to re-deploy it either by running ",(0,n.kt)("inlineCode",{parentName:"li"},"yarn deploy:<environment>")," from the ",(0,n.kt)("inlineCode",{parentName:"li"},"api")," folder or by pushing a new commit to the GitHub repository and let GitHub Actions do the heavy lifting")),(0,n.kt)("p",null,"Now you should be able to accept payments in your deployed application!"),(0,n.kt)("h2",{id:"webhooks"},"Webhooks"),(0,n.kt)("p",null,"Whenever a customer makes a purchase through your Stripe checkout flow, the database needs to be updated to add a subscription for the user who made the purchase. This is done using webhooks. You will need to set up a webhook for each environment that your project runs in."),(0,n.kt)("ol",null,(0,n.kt)("li",{parentName:"ol"},"Sign in to the Stripe dashboard"),(0,n.kt)("li",{parentName:"ol"},"Go to the Developers tab"),(0,n.kt)("li",{parentName:"ol"},"Go to Webhooks"),(0,n.kt)("li",{parentName:"ol"},"Click Add endpoint"),(0,n.kt)("li",{parentName:"ol"},"Enter the following values\nEndpoint URL: ",(0,n.kt)("inlineCode",{parentName:"li"},"<your-api-url>/stripe/webhook"),"\nEvents: ",(0,n.kt)("inlineCode",{parentName:"li"},"customer.subscription.created"),"and ",(0,n.kt)("inlineCode",{parentName:"li"},"customer.subscription.deleted")),(0,n.kt)("li",{parentName:"ol"},"Leave the rest as default and click Add endpoint")),(0,n.kt)("p",null,"Next, we need to add the webhook secret to our configuration."),(0,n.kt)("ol",null,(0,n.kt)("li",{parentName:"ol"},"Click the webhook you created in the Stripe dashboard"),(0,n.kt)("li",{parentName:"ol"},"Click Signing secret -> Reveal"),(0,n.kt)("li",{parentName:"ol"},"Copy the secret"),(0,n.kt)("li",{parentName:"ol"},"Go into AWS -> Systems Manager -> Parameter Store"),(0,n.kt)("li",{parentName:"ol"},"Find the STRIPE_WEBHOOK_SECRET parameter and update it with the value from Stripe"),(0,n.kt)("li",{parentName:"ol"},"Re-deploy your project")),(0,n.kt)("p",null,"Now you are done! Stripe will alert you if your webhook would fail."))}s.isMDXComponent=!0}}]);